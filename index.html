<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>à¸ªà¸¸à¹ˆà¸¡à¸•à¸±à¸§à¸¥à¸°à¸„à¸£ - à¸‚à¸¹à¸”à¸”à¸¹</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f9f9f9;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 40px;
    }

    h1 {
      margin-bottom: 20px;
      color: #333;
    }

    #scratch-container {
      position: relative;
      width: 300px;
      height: 400px;
      border: 1px solid #ccc;
      border-radius: 12px;
      overflow: hidden;
      background: #eee;
      margin-top: 20px;
    }

    #scratch-container img,
    #scratch-container canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      background: #333;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:disabled {
      background: #aaa;
      cursor: not-allowed;
    }

    button:hover:enabled {
      background: #555;
    }
  </style>
</head>
<body>
  <h1>à¸‚à¸¹à¸”à¸”à¸¹à¸§à¹ˆà¸²à¸„à¸¸à¸“à¹„à¸”à¹‰à¸•à¸±à¸§à¸¥à¸°à¸„à¸£à¸­à¸°à¹„à¸£</h1>
  <button id="reveal-btn" onclick="revealCharacter()">à¸ªà¸¸à¹ˆà¸¡à¸•à¸±à¸§à¸¥à¸°à¸„à¸£</button>

  <div id="scratch-container">
    <img id="character-img" src="" alt="Character" style="z-index: 1; display: none;" />
    <canvas id="scratch-canvas-2" style="z-index: 2;"></canvas>
    <canvas id="scratch-canvas-1" style="z-index: 3;"></canvas>
  </div>

<audio
    id="scratch-sound"
    src="https://raw.githubusercontent.com/Rin26-Nirin/scratch-card-web/main/card_scratch.wav"
    preload="auto"
  ></audio>

 <script>
  const images = [
    'https://i.pinimg.com/736x/ca/d1/91/cad191b61f65458fcc687c9874793122.jpg',
    'https://i.pinimg.com/736x/8e/ac/e1/8eace192a4dca9dba5b25c6a8e7b2dc1.jpg',
    'https://i.pinimg.com/736x/f3/72/77/f3727751489bd9a8fd41e770130d633c.jpg'
  ];

  const canvas1 = document.getElementById('scratch-canvas-1');
  const canvas2 = document.getElementById('scratch-canvas-2');
  const ctx1 = canvas1.getContext('2d');
  const ctx2 = canvas2.getContext('2d');
  const container = document.getElementById('scratch-container');
  const img = document.getElementById('character-img');

  const scratchSound = document.getElementById('scratch-sound');

  let isDrawing = false;
  let currentScratchStage = 1;
  let revealedPixels1 = 0;
  let revealedPixels2 = 0;
  let hasRevealed = false; // ðŸ‘ˆ à¹€à¸žà¸´à¹ˆà¸¡à¸•à¸±à¸§à¹à¸›à¸£à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸à¸²à¸£à¹€à¸¥à¹ˆà¸™à¸à¹ˆà¸­à¸™à¸ªà¸¸à¹ˆà¸¡

  // à¸‹à¹ˆà¸­à¸™ canvas à¹à¸¥à¸°à¸£à¸¹à¸›à¸•à¸­à¸™à¹‚à¸«à¸¥à¸”
  window.onload = () => {
    canvas1.style.display = 'none';
    canvas2.style.display = 'none';
    img.style.display = 'none';
  };

  function setupCanvas(ctx, canvas, color = '#CCCCCC') {
    canvas.width = container.clientWidth;
    canvas.height = container.clientHeight;
    ctx.globalCompositeOperation = 'source-over';
    ctx.fillStyle = color;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.globalCompositeOperation = 'destination-out';
    canvas.style.display = 'block';
  }

  function revealCharacter() {
    if (hasRevealed) return; // âŒ à¸›à¹‰à¸­à¸‡à¸à¸±à¸™à¸à¸²à¸£à¸à¸”à¸‹à¹‰à¸³
    hasRevealed = true;

    const randomImg = images[Math.floor(Math.random() * images.length)];
    img.src = randomImg;
    img.style.display = 'block';

    setupCanvas(ctx1, canvas1, '#CCCCCC');
    setupCanvas(ctx2, canvas2, '#999999');

    currentScratchStage = 1;
    revealedPixels1 = 0;
    revealedPixels2 = 0;
  }

  function playScratchSound() {
    try {
      scratchSound.currentTime = 0;
      scratchSound.play();
    } catch (e) {
      console.warn("à¹€à¸ªà¸µà¸¢à¸‡à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸¥à¹ˆà¸™à¹„à¸”à¹‰à¸•à¸­à¸™à¸™à¸µà¹‰");
    }
  }

  function handleScratch(e, canvas, ctx, stage) {
    if (!isDrawing || !hasRevealed) return;

    const rect = canvas.getBoundingClientRect();
    const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
    const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;

    ctx.beginPath();
    ctx.arc(x, y, 20, 0, 2 * Math.PI);
    ctx.fill();

    playScratchSound();

    if (stage === 1) {
      revealedPixels1++;
      if (revealedPixels1 > 500) {
        canvas1.style.display = 'none';
        currentScratchStage = 2;
      }
    } else if (stage === 2) {
      revealedPixels2++;
      if (revealedPixels2 > 500) {
        canvas2.style.display = 'none';
      }
    }
  }

  // mouse + touch events
  [canvas1, canvas2].forEach((canvas, index) => {
    const ctx = index === 0 ? ctx1 : ctx2;
    canvas.addEventListener('mousedown', () => (isDrawing = true));
    canvas.addEventListener('mouseup', () => (isDrawing = false));
    canvas.addEventListener('mousemove', (e) => handleScratch(e, canvas, ctx, index + 1));

    canvas.addEventListener('touchstart', () => (isDrawing = true));
    canvas.addEventListener('touchend', () => (isDrawing = false));
    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      handleScratch(e, canvas, ctx, index + 1);
    });
  });
</script>
</body>
</html>
